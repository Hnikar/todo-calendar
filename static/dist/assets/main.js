/*! For license information please see main.js.LICENSE.txt */
(()=>{"use strict";var t={"./src/modules/auth.js":(e,t,o)=>{o.r(t),o.d(t,{Auth:()=>r});var s=o("./src/modules/loader.js"),n=o("./src/modules/domUtils.js");const r=(()=>{function e(){const e=document.getElementById("authForm");if(!e)return console.error("Auth form not found!");e.addEventListener("submit",o),t("login"),document.querySelectorAll("[data-mode]").forEach((e=>e.addEventListener("click",(()=>{t(e.dataset.mode)}))))}function t(e){const t=document.getElementById("nameField"),o=document.querySelector('#authForm button[type="submit"]'),s=document.getElementById("password"),r=document.querySelectorAll(".tab");t&&(t.style.display="register"===e?"block":"none",document.getElementById("name").required="register"===e),r.forEach((t=>t.classList.toggle("active",t.dataset.mode===e))),o&&(o.textContent="login"===e?"Login":"Register"),s&&(s.autocomplete="login"===e?"current-password":"new-password"),n.DomUtils.clearMessages()}async function o(e){e.preventDefault(),n.DomUtils.clearMessages(),s.Loader.toggle(!0);const o=document.querySelector('[data-mode="login"]').classList.contains("active"),a=o?"/api/login":"/api/register",c={email:r("email"),password:r("password")};o||(c.name=r("name"));try{!function(e,t){const o=[];if(e.email?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.email)||o.push("Invalid email format."):o.push("Email is required."),e.password?e.password.length<8&&!t&&o.push("Password must be at least 8 characters."):o.push("Password is required."),t||e.name&&!(e.name.length<2)||o.push("Name must be at least 2 characters."),o.length)throw new Error(o.join("\n"))}(c,o);const e=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(c)});await async function(e,o){const s=e.headers.get("content-type")?.includes("application/json"),r=s?await e.json():{message:await e.text()};if(!e.ok)throw new Error(r.error||`Error: ${e.status}`);o?(localStorage.setItem("user",JSON.stringify(r.user||{})),window.location.href="/app"):(n.DomUtils.showSuccess(r.message||"Registration successful. Please login."),t("login"),["email","password","name"].forEach((e=>{const t=document.getElementById(e);t&&(t.value="")})))}(e,o)}catch(e){n.DomUtils.showError(e.message||"Unexpected error during submission.")}finally{s.Loader.toggle(!1)}}function r(e){const t=document.getElementById(e);return t?t.value.trim():""}return document.addEventListener("DOMContentLoaded",(()=>{e(),function(){const e=new URLSearchParams(location.search).get("reason"),t={unauthenticated:"Please log in to access the application.",invalid_token:"Session expired. Please log in again.",bad_token_claims:"Session data issue. Please log in again."};e&&t[e]&&n.DomUtils.showError(t[e]),history.replaceState(null,"",location.pathname)}()})),{init:e}})()},"./src/modules/domUtils.js":(e,t,o)=>{o.r(t),o.d(t,{DomUtils:()=>s});const s=(()=>{function e(){const e=document.getElementById("messageContainer");e&&(e.innerHTML=""),document.querySelectorAll(".error-message, .success-message").forEach((t=>{t.parentNode!==e&&t.remove()}))}function t(t,o="error"){e();const s=document.createElement("div");s.className="error"===o?"error-message":"success-message",t.split("\n").forEach((e=>{const t=document.createElement("p");t.textContent=e,s.appendChild(t)}));const n=document.getElementById("messageContainer");if(n)n.appendChild(s);else{const e=document.getElementById("authForm");e?e.parentNode.insertBefore(s,e):document.body.prepend(s)}}return{clearMessages:e,showError:e=>t(e,"error"),showSuccess:e=>t(e,"success")}})()},"./src/modules/events.js":(e,t,o)=>{o.r(t),o.d(t,{Events:()=>n});var s=o("./src/modules/loader.js");const n={fetchAndDisplay:async function(){const e=document.getElementById("eventsOutput");if(e){e.innerHTML="Loading events...",s.Loader.toggle(!0);try{const t=await fetch("/api/events",{method:"GET",headers:{Accept:"application/json"}});if(!t.ok){const e=await t.json().catch((()=>({})));throw new Error(e.error||`HTTP error! Status: ${t.status}`)}const o=await t.json();e.innerHTML=o.length?"<h4>Received Events:</h4><pre>"+JSON.stringify(o,null,2)+"</pre>":"No events found for your account."}catch(t){console.error("Error fetching events:",t),e.innerHTML=`<p class="api-error-message">Error loading events: ${t.message}</p>`}finally{s.Loader.toggle(!1)}}}}},"./src/modules/loader.js":(e,t,o)=>{o.r(t),o.d(t,{Loader:()=>s});const s={toggle:function(e){let t=document.getElementById("loader");!t&&e&&(t=function(){const e=document.createElement("div");return e.id="loader",e.className="loader",e.innerHTML='<div class="spinner"></div>',document.body.appendChild(e),e}()),t&&(t.style.display=e?"flex":"none")}}},"./src/modules/user.js":(e,t,o)=>{o.r(t),o.d(t,{User:()=>r});var s=o("./src/modules/loader.js"),n=o("./src/modules/domUtils.js");const r={logout:async function(){console.log("Attempting logout..."),s.Loader.toggle(!0);try{const e=await fetch("/api/logout",{method:"POST",headers:{Accept:"application/json"}}),t=await e.json().catch((()=>({})));if(!e.ok)throw new Error(t.error||`Logout failed with status: ${e.status}`);console.log("Logout successful via API.")}catch(e){console.error("Logout API call failed:",e),n.DomUtils.showError("Could not properly log out. Clear cookies manually if needed.")}finally{localStorage.removeItem("user"),s.Loader.toggle(!1),window.location.href="/login"}},displayUserData:function(){}}}},o={};function s(e){var n=o[e];if(void 0!==n)return n.exports;var r=o[e]={exports:{}};return t[e](r,r.exports,s),r.exports}s.d=(e,t)=>{for(var o in t)s.o(t,o)&&!s.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n={};(()=>{s.r(n);var t=s("./src/modules/user.js"),o=s("./src/modules/events.js");s("./src/modules/auth.js"),document.addEventListener("DOMContentLoaded",(()=>{t.User.displayUserData();const s=document.getElementById("btn-logout");s&&s.addEventListener("click",t.User.logout);const n=document.getElementById("fetchEventsBtn");n&&n.addEventListener("click",(()=>{e.preventDefault(),o.Events.fetchAndDisplay})),console.log("Main app initialized.")}))})()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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U0ssRUFBSyxDQUFFSSxZQUFZLEVBQU01RSxJQUFLdUUsRUFBV0MsSUFFMUUsRUNORFQsRUFBb0JVLEVBQUksQ0FBQ0ksRUFBS0MsSUFBVUosT0FBT0ssVUFBVUMsZUFBZUMsS0FBS0osRUFBS0MsR0NDbEZmLEVBQW9CbUIsRUFBS2YsSUFDSCxvQkFBWGdCLFFBQTBCQSxPQUFPQyxhQUMxQ1YsT0FBT0MsZUFBZVIsRUFBU2dCLE9BQU9DLFlBQWEsQ0FBRXBFLE1BQU8sV0FFN0QwRCxPQUFPQyxlQUFlUixFQUFTLGFBQWMsQ0FBRW5ELE9BQU8sR0FBTyxtSENEOUR2RSxTQUFTSSxpQkFBaUIsb0JBQW9CLEtBQzVDLEVBQUE0RyxLQUFLSSxrQkFDTCxNQUFNd0IsRUFBWTVJLFNBQVNDLGVBQWUsY0FDdEMySSxHQUFXQSxFQUFVeEksaUJBQWlCLFFBQVMsRUFBQTRHLEtBQUtDLFFBRXhELE1BQU00QixFQUFZN0ksU0FBU0MsZUFBZSxrQkFDdEM0SSxHQUNGQSxFQUFVekksaUJBQWlCLFNBQVMsS0FDbEN1QixFQUFFQyxpQkFDRixFQUFBMkUsT0FBT0MsZUFBZSxJQUcxQnRHLFFBQVFnSCxJQUFJLHdCQUF3QiIsInNvdXJjZXMiOlsid2VicGFjazovL3N0YXRpYy8uL3NyYy9tb2R1bGVzL2F1dGguanMiLCJ3ZWJwYWNrOi8vc3RhdGljLy4vc3JjL21vZHVsZXMvZG9tVXRpbHMuanMiLCJ3ZWJwYWNrOi8vc3RhdGljLy4vc3JjL21vZHVsZXMvZXZlbnRzLmpzIiwid2VicGFjazovL3N0YXRpYy8uL3NyYy9tb2R1bGVzL2xvYWRlci5qcyIsIndlYnBhY2s6Ly9zdGF0aWMvLi9zcmMvbW9kdWxlcy91c2VyLmpzIiwid2VicGFjazovL3N0YXRpYy93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly9zdGF0aWMvd2VicGFjay9ydW50aW1lL2RlZmluZSBwcm9wZXJ0eSBnZXR0ZXJzIiwid2VicGFjazovL3N0YXRpYy93ZWJwYWNrL3J1bnRpbWUvaGFzT3duUHJvcGVydHkgc2hvcnRoYW5kIiwid2VicGFjazovL3N0YXRpYy93ZWJwYWNrL3J1bnRpbWUvbWFrZSBuYW1lc3BhY2Ugb2JqZWN0Iiwid2VicGFjazovL3N0YXRpYy8uL3NyYy9pbmRleC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBMb2FkZXIgfSBmcm9tIFwiLi9sb2FkZXIuanNcIjtcclxuaW1wb3J0IHsgRG9tVXRpbHMgfSBmcm9tIFwiLi9kb21VdGlscy5qc1wiO1xyXG5cclxuZXhwb3J0IGNvbnN0IEF1dGggPSAoKCkgPT4ge1xyXG4gIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJET01Db250ZW50TG9hZGVkXCIsICgpID0+IHtcclxuICAgIGluaXQoKTtcclxuICAgIGNoZWNrUmVkaXJlY3RSZWFzb24oKTtcclxuICB9KTtcclxuXHJcbiAgZnVuY3Rpb24gaW5pdCgpIHtcclxuICAgIGNvbnN0IGZvcm0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImF1dGhGb3JtXCIpO1xyXG4gICAgaWYgKCFmb3JtKSByZXR1cm4gY29uc29sZS5lcnJvcihcIkF1dGggZm9ybSBub3QgZm91bmQhXCIpO1xyXG5cclxuICAgIGZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBoYW5kbGVTdWJtaXQpO1xyXG4gICAgc3dpdGNoTW9kZShcImxvZ2luXCIpO1xyXG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIltkYXRhLW1vZGVdXCIpLmZvckVhY2goKHRhYikgPT5cclxuICAgICAgdGFiLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgICAgICAgc3dpdGNoTW9kZSh0YWIuZGF0YXNldC5tb2RlKTtcclxuICAgICAgfSlcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBzd2l0Y2hNb2RlKG1vZGUpIHtcclxuICAgIGNvbnN0IG5hbWVGaWVsZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwibmFtZUZpZWxkXCIpO1xyXG4gICAgY29uc3Qgc3VibWl0QnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2F1dGhGb3JtIGJ1dHRvblt0eXBlPVwic3VibWl0XCJdJyk7XHJcbiAgICBjb25zdCBwYXNzd29yZElucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJwYXNzd29yZFwiKTtcclxuICAgIGNvbnN0IHRhYnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLnRhYlwiKTtcclxuXHJcbiAgICBpZiAobmFtZUZpZWxkKSB7XHJcbiAgICAgIG5hbWVGaWVsZC5zdHlsZS5kaXNwbGF5ID0gbW9kZSA9PT0gXCJyZWdpc3RlclwiID8gXCJibG9ja1wiIDogXCJub25lXCI7XHJcbiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwibmFtZVwiKS5yZXF1aXJlZCA9IG1vZGUgPT09IFwicmVnaXN0ZXJcIjtcclxuICAgIH1cclxuICAgIHRhYnMuZm9yRWFjaCgodGFiKSA9PlxyXG4gICAgICB0YWIuY2xhc3NMaXN0LnRvZ2dsZShcImFjdGl2ZVwiLCB0YWIuZGF0YXNldC5tb2RlID09PSBtb2RlKVxyXG4gICAgKTtcclxuICAgIGlmIChzdWJtaXRCdG4pXHJcbiAgICAgIHN1Ym1pdEJ0bi50ZXh0Q29udGVudCA9IG1vZGUgPT09IFwibG9naW5cIiA/IFwiTG9naW5cIiA6IFwiUmVnaXN0ZXJcIjtcclxuICAgIGlmIChwYXNzd29yZElucHV0KVxyXG4gICAgICBwYXNzd29yZElucHV0LmF1dG9jb21wbGV0ZSA9XHJcbiAgICAgICAgbW9kZSA9PT0gXCJsb2dpblwiID8gXCJjdXJyZW50LXBhc3N3b3JkXCIgOiBcIm5ldy1wYXNzd29yZFwiO1xyXG5cclxuICAgIERvbVV0aWxzLmNsZWFyTWVzc2FnZXMoKTtcclxuICB9XHJcblxyXG4gIGFzeW5jIGZ1bmN0aW9uIGhhbmRsZVN1Ym1pdChlKSB7XHJcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICBEb21VdGlscy5jbGVhck1lc3NhZ2VzKCk7XHJcbiAgICBMb2FkZXIudG9nZ2xlKHRydWUpO1xyXG5cclxuICAgIGNvbnN0IGlzTG9naW4gPSBkb2N1bWVudFxyXG4gICAgICAucXVlcnlTZWxlY3RvcignW2RhdGEtbW9kZT1cImxvZ2luXCJdJylcclxuICAgICAgLmNsYXNzTGlzdC5jb250YWlucyhcImFjdGl2ZVwiKTtcclxuICAgIGNvbnN0IHVybCA9IGlzTG9naW4gPyBcIi9hcGkvbG9naW5cIiA6IFwiL2FwaS9yZWdpc3RlclwiO1xyXG4gICAgY29uc3QgZm9ybURhdGEgPSB7XHJcbiAgICAgIGVtYWlsOiBnZXRWYWwoXCJlbWFpbFwiKSxcclxuICAgICAgcGFzc3dvcmQ6IGdldFZhbChcInBhc3N3b3JkXCIpLFxyXG4gICAgfTtcclxuXHJcbiAgICBpZiAoIWlzTG9naW4pIGZvcm1EYXRhLm5hbWUgPSBnZXRWYWwoXCJuYW1lXCIpO1xyXG5cclxuICAgIHRyeSB7XHJcbiAgICAgIHZhbGlkYXRlKGZvcm1EYXRhLCBpc0xvZ2luKTtcclxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCh1cmwsIHtcclxuICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxyXG4gICAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxyXG4gICAgICAgICAgQWNjZXB0OiBcImFwcGxpY2F0aW9uL2pzb25cIixcclxuICAgICAgICB9LFxyXG4gICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KGZvcm1EYXRhKSxcclxuICAgICAgfSk7XHJcbiAgICAgIGF3YWl0IGhhbmRsZVJlc3BvbnNlKHJlc3BvbnNlLCBpc0xvZ2luKTtcclxuICAgIH0gY2F0Y2ggKGVycikge1xyXG4gICAgICBEb21VdGlscy5zaG93RXJyb3IoZXJyLm1lc3NhZ2UgfHwgXCJVbmV4cGVjdGVkIGVycm9yIGR1cmluZyBzdWJtaXNzaW9uLlwiKTtcclxuICAgIH0gZmluYWxseSB7XHJcbiAgICAgIExvYWRlci50b2dnbGUoZmFsc2UpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gZ2V0VmFsKGlkKSB7XHJcbiAgICBjb25zdCBlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKTtcclxuICAgIHJldHVybiBlbCA/IGVsLnZhbHVlLnRyaW0oKSA6IFwiXCI7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiB2YWxpZGF0ZShkYXRhLCBpc0xvZ2luKSB7XHJcbiAgICBjb25zdCBlcnJvcnMgPSBbXTtcclxuICAgIGNvbnN0IGVtYWlsUmVnZXggPSAvXlteXFxzQF0rQFteXFxzQF0rXFwuW15cXHNAXSskLztcclxuXHJcbiAgICBpZiAoIWRhdGEuZW1haWwpIGVycm9ycy5wdXNoKFwiRW1haWwgaXMgcmVxdWlyZWQuXCIpO1xyXG4gICAgZWxzZSBpZiAoIWVtYWlsUmVnZXgudGVzdChkYXRhLmVtYWlsKSkgZXJyb3JzLnB1c2goXCJJbnZhbGlkIGVtYWlsIGZvcm1hdC5cIik7XHJcbiAgICBpZiAoIWRhdGEucGFzc3dvcmQpIGVycm9ycy5wdXNoKFwiUGFzc3dvcmQgaXMgcmVxdWlyZWQuXCIpO1xyXG4gICAgZWxzZSBpZiAoZGF0YS5wYXNzd29yZC5sZW5ndGggPCA4ICYmICFpc0xvZ2luKVxyXG4gICAgICBlcnJvcnMucHVzaChcIlBhc3N3b3JkIG11c3QgYmUgYXQgbGVhc3QgOCBjaGFyYWN0ZXJzLlwiKTtcclxuICAgIGlmICghaXNMb2dpbiAmJiAoIWRhdGEubmFtZSB8fCBkYXRhLm5hbWUubGVuZ3RoIDwgMikpXHJcbiAgICAgIGVycm9ycy5wdXNoKFwiTmFtZSBtdXN0IGJlIGF0IGxlYXN0IDIgY2hhcmFjdGVycy5cIik7XHJcblxyXG4gICAgaWYgKGVycm9ycy5sZW5ndGgpIHRocm93IG5ldyBFcnJvcihlcnJvcnMuam9pbihcIlxcblwiKSk7XHJcbiAgfVxyXG5cclxuICBhc3luYyBmdW5jdGlvbiBoYW5kbGVSZXNwb25zZShyZXNwb25zZSwgaXNMb2dpbikge1xyXG4gICAgY29uc3QgaXNKc29uID0gcmVzcG9uc2UuaGVhZGVyc1xyXG4gICAgICAuZ2V0KFwiY29udGVudC10eXBlXCIpXHJcbiAgICAgID8uaW5jbHVkZXMoXCJhcHBsaWNhdGlvbi9qc29uXCIpO1xyXG4gICAgY29uc3QgZGF0YSA9IGlzSnNvblxyXG4gICAgICA/IGF3YWl0IHJlc3BvbnNlLmpzb24oKVxyXG4gICAgICA6IHsgbWVzc2FnZTogYXdhaXQgcmVzcG9uc2UudGV4dCgpIH07XHJcblxyXG4gICAgaWYgKCFyZXNwb25zZS5vaylcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKGRhdGEuZXJyb3IgfHwgYEVycm9yOiAke3Jlc3BvbnNlLnN0YXR1c31gKTtcclxuXHJcbiAgICBpZiAoaXNMb2dpbikge1xyXG4gICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShcInVzZXJcIiwgSlNPTi5zdHJpbmdpZnkoZGF0YS51c2VyIHx8IHt9KSk7XHJcbiAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gXCIvYXBwXCI7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBEb21VdGlscy5zaG93U3VjY2VzcyhcclxuICAgICAgICBkYXRhLm1lc3NhZ2UgfHwgXCJSZWdpc3RyYXRpb24gc3VjY2Vzc2Z1bC4gUGxlYXNlIGxvZ2luLlwiXHJcbiAgICAgICk7XHJcbiAgICAgIHN3aXRjaE1vZGUoXCJsb2dpblwiKTtcclxuICAgICAgW1wiZW1haWxcIiwgXCJwYXNzd29yZFwiLCBcIm5hbWVcIl0uZm9yRWFjaCgoaWQpID0+IHtcclxuICAgICAgICBjb25zdCBlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKTtcclxuICAgICAgICBpZiAoZWwpIGVsLnZhbHVlID0gXCJcIjtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBjaGVja1JlZGlyZWN0UmVhc29uKCkge1xyXG4gICAgY29uc3QgcmVhc29uID0gbmV3IFVSTFNlYXJjaFBhcmFtcyhsb2NhdGlvbi5zZWFyY2gpLmdldChcInJlYXNvblwiKTtcclxuICAgIGNvbnN0IG1lc3NhZ2VzID0ge1xyXG4gICAgICB1bmF1dGhlbnRpY2F0ZWQ6IFwiUGxlYXNlIGxvZyBpbiB0byBhY2Nlc3MgdGhlIGFwcGxpY2F0aW9uLlwiLFxyXG4gICAgICBpbnZhbGlkX3Rva2VuOiBcIlNlc3Npb24gZXhwaXJlZC4gUGxlYXNlIGxvZyBpbiBhZ2Fpbi5cIixcclxuICAgICAgYmFkX3Rva2VuX2NsYWltczogXCJTZXNzaW9uIGRhdGEgaXNzdWUuIFBsZWFzZSBsb2cgaW4gYWdhaW4uXCIsXHJcbiAgICB9O1xyXG4gICAgaWYgKHJlYXNvbiAmJiBtZXNzYWdlc1tyZWFzb25dKSBEb21VdGlscy5zaG93RXJyb3IobWVzc2FnZXNbcmVhc29uXSk7XHJcbiAgICBoaXN0b3J5LnJlcGxhY2VTdGF0ZShudWxsLCBcIlwiLCBsb2NhdGlvbi5wYXRobmFtZSk7XHJcbiAgfVxyXG5cclxuICByZXR1cm4geyBpbml0IH07XHJcbn0pKCk7XHJcbiIsImV4cG9ydCBjb25zdCBEb21VdGlscyA9ICgoKSA9PiB7XHJcbiAgZnVuY3Rpb24gY2xlYXJNZXNzYWdlcygpIHtcclxuICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwibWVzc2FnZUNvbnRhaW5lclwiKTtcclxuICAgIGlmIChjb250YWluZXIpIGNvbnRhaW5lci5pbm5lckhUTUwgPSBcIlwiO1xyXG4gICAgZG9jdW1lbnRcclxuICAgICAgLnF1ZXJ5U2VsZWN0b3JBbGwoXCIuZXJyb3ItbWVzc2FnZSwgLnN1Y2Nlc3MtbWVzc2FnZVwiKVxyXG4gICAgICAuZm9yRWFjaCgoZWwpID0+IHtcclxuICAgICAgICBpZiAoZWwucGFyZW50Tm9kZSAhPT0gY29udGFpbmVyKSBlbC5yZW1vdmUoKTtcclxuICAgICAgfSk7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBzaG93TWVzc2FnZShtZXNzYWdlLCB0eXBlID0gXCJlcnJvclwiKSB7XHJcbiAgICBjbGVhck1lc3NhZ2VzKCk7XHJcbiAgICBjb25zdCBtZXNzYWdlRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICBtZXNzYWdlRWxlbWVudC5jbGFzc05hbWUgPVxyXG4gICAgICB0eXBlID09PSBcImVycm9yXCIgPyBcImVycm9yLW1lc3NhZ2VcIiA6IFwic3VjY2Vzcy1tZXNzYWdlXCI7XHJcbiAgICBtZXNzYWdlLnNwbGl0KFwiXFxuXCIpLmZvckVhY2goKGxpbmUpID0+IHtcclxuICAgICAgY29uc3QgcCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJwXCIpO1xyXG4gICAgICBwLnRleHRDb250ZW50ID0gbGluZTtcclxuICAgICAgbWVzc2FnZUVsZW1lbnQuYXBwZW5kQ2hpbGQocCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIm1lc3NhZ2VDb250YWluZXJcIik7XHJcbiAgICBpZiAoY29udGFpbmVyKSB7XHJcbiAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChtZXNzYWdlRWxlbWVudCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBjb25zdCBmb3JtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJhdXRoRm9ybVwiKTtcclxuICAgICAgZm9ybVxyXG4gICAgICAgID8gZm9ybS5wYXJlbnROb2RlLmluc2VydEJlZm9yZShtZXNzYWdlRWxlbWVudCwgZm9ybSlcclxuICAgICAgICA6IGRvY3VtZW50LmJvZHkucHJlcGVuZChtZXNzYWdlRWxlbWVudCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICByZXR1cm4ge1xyXG4gICAgY2xlYXJNZXNzYWdlcyxcclxuICAgIHNob3dFcnJvcjogKG1zZykgPT4gc2hvd01lc3NhZ2UobXNnLCBcImVycm9yXCIpLFxyXG4gICAgc2hvd1N1Y2Nlc3M6IChtc2cpID0+IHNob3dNZXNzYWdlKG1zZywgXCJzdWNjZXNzXCIpLFxyXG4gIH07XHJcbn0pKCk7XHJcbiIsImltcG9ydCB7IExvYWRlciB9IGZyb20gXCIuL2xvYWRlci5qc1wiO1xyXG5cclxuZXhwb3J0IGNvbnN0IEV2ZW50cyA9ICgoKSA9PiB7XHJcbiAgYXN5bmMgZnVuY3Rpb24gZmV0Y2hBbmREaXNwbGF5KCkge1xyXG4gICAgY29uc3Qgb3V0cHV0RGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJldmVudHNPdXRwdXRcIik7XHJcbiAgICBpZiAoIW91dHB1dERpdikgcmV0dXJuO1xyXG5cclxuICAgIG91dHB1dERpdi5pbm5lckhUTUwgPSBcIkxvYWRpbmcgZXZlbnRzLi4uXCI7XHJcbiAgICBMb2FkZXIudG9nZ2xlKHRydWUpO1xyXG5cclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goXCIvYXBpL2V2ZW50c1wiLCB7XHJcbiAgICAgICAgbWV0aG9kOiBcIkdFVFwiLFxyXG4gICAgICAgIGhlYWRlcnM6IHsgQWNjZXB0OiBcImFwcGxpY2F0aW9uL2pzb25cIiB9LFxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGlmICghcmVzcG9uc2Uub2spIHtcclxuICAgICAgICBjb25zdCBlcnJvckRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCkuY2F0Y2goKCkgPT4gKHt9KSk7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxyXG4gICAgICAgICAgZXJyb3JEYXRhLmVycm9yIHx8IGBIVFRQIGVycm9yISBTdGF0dXM6ICR7cmVzcG9uc2Uuc3RhdHVzfWBcclxuICAgICAgICApO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCBldmVudHMgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XHJcbiAgICAgIG91dHB1dERpdi5pbm5lckhUTUwgPSBldmVudHMubGVuZ3RoXHJcbiAgICAgICAgPyBcIjxoND5SZWNlaXZlZCBFdmVudHM6PC9oND48cHJlPlwiICtcclxuICAgICAgICAgIEpTT04uc3RyaW5naWZ5KGV2ZW50cywgbnVsbCwgMikgK1xyXG4gICAgICAgICAgXCI8L3ByZT5cIlxyXG4gICAgICAgIDogXCJObyBldmVudHMgZm91bmQgZm9yIHlvdXIgYWNjb3VudC5cIjtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBmZXRjaGluZyBldmVudHM6XCIsIGVycm9yKTtcclxuICAgICAgb3V0cHV0RGl2LmlubmVySFRNTCA9IGA8cCBjbGFzcz1cImFwaS1lcnJvci1tZXNzYWdlXCI+RXJyb3IgbG9hZGluZyBldmVudHM6ICR7ZXJyb3IubWVzc2FnZX08L3A+YDtcclxuICAgIH0gZmluYWxseSB7XHJcbiAgICAgIExvYWRlci50b2dnbGUoZmFsc2UpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcmV0dXJuIHsgZmV0Y2hBbmREaXNwbGF5IH07XHJcbn0pKCk7XHJcbiIsImV4cG9ydCBjb25zdCBMb2FkZXIgPSAoKCkgPT4ge1xyXG4gIGZ1bmN0aW9uIHRvZ2dsZShzaG93KSB7XHJcbiAgICBsZXQgbG9hZGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJsb2FkZXJcIik7XHJcbiAgICBpZiAoIWxvYWRlciAmJiBzaG93KSBsb2FkZXIgPSBjcmVhdGUoKTtcclxuICAgIGlmIChsb2FkZXIpIGxvYWRlci5zdHlsZS5kaXNwbGF5ID0gc2hvdyA/IFwiZmxleFwiIDogXCJub25lXCI7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBjcmVhdGUoKSB7XHJcbiAgICBjb25zdCBsb2FkZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgbG9hZGVyLmlkID0gXCJsb2FkZXJcIjtcclxuICAgIGxvYWRlci5jbGFzc05hbWUgPSBcImxvYWRlclwiO1xyXG4gICAgbG9hZGVyLmlubmVySFRNTCA9ICc8ZGl2IGNsYXNzPVwic3Bpbm5lclwiPjwvZGl2Pic7XHJcbiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGxvYWRlcik7XHJcbiAgICByZXR1cm4gbG9hZGVyO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIHsgdG9nZ2xlIH07XHJcbn0pKCk7XHJcbiIsImltcG9ydCB7IExvYWRlciB9IGZyb20gXCIuL2xvYWRlci5qc1wiO1xyXG5pbXBvcnQgeyBEb21VdGlscyB9IGZyb20gXCIuL2RvbVV0aWxzLmpzXCI7XHJcblxyXG5leHBvcnQgY29uc3QgVXNlciA9ICgoKSA9PiB7XHJcbiAgYXN5bmMgZnVuY3Rpb24gbG9nb3V0KCkge1xyXG4gICAgY29uc29sZS5sb2coXCJBdHRlbXB0aW5nIGxvZ291dC4uLlwiKTtcclxuICAgIExvYWRlci50b2dnbGUodHJ1ZSk7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKFwiL2FwaS9sb2dvdXRcIiwge1xyXG4gICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXHJcbiAgICAgICAgaGVhZGVyczogeyBBY2NlcHQ6IFwiYXBwbGljYXRpb24vanNvblwiIH0sXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKS5jYXRjaCgoKSA9PiAoe30pKTtcclxuICAgICAgaWYgKCFyZXNwb25zZS5vaylcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXHJcbiAgICAgICAgICBkYXRhLmVycm9yIHx8IGBMb2dvdXQgZmFpbGVkIHdpdGggc3RhdHVzOiAke3Jlc3BvbnNlLnN0YXR1c31gXHJcbiAgICAgICAgKTtcclxuICAgICAgY29uc29sZS5sb2coXCJMb2dvdXQgc3VjY2Vzc2Z1bCB2aWEgQVBJLlwiKTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJMb2dvdXQgQVBJIGNhbGwgZmFpbGVkOlwiLCBlcnJvcik7XHJcbiAgICAgIERvbVV0aWxzLnNob3dFcnJvcihcclxuICAgICAgICBcIkNvdWxkIG5vdCBwcm9wZXJseSBsb2cgb3V0LiBDbGVhciBjb29raWVzIG1hbnVhbGx5IGlmIG5lZWRlZC5cIlxyXG4gICAgICApO1xyXG4gICAgfSBmaW5hbGx5IHtcclxuICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oXCJ1c2VyXCIpO1xyXG4gICAgICBMb2FkZXIudG9nZ2xlKGZhbHNlKTtcclxuICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBcIi9sb2dpblwiO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gZGlzcGxheVVzZXJEYXRhKCkge1xyXG4gICAgLy8gY29uc3QgdXNlckRhdGFTdHJpbmcgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShcInVzZXJcIik7XHJcbiAgICAvLyBpZiAoIXVzZXJEYXRhU3RyaW5nKSByZXR1cm4gbG9nb3V0KCk7XHJcbiAgICAvLyB0cnkge1xyXG4gICAgLy8gICBjb25zdCB1c2VyRGF0YSA9IEpTT04ucGFyc2UodXNlckRhdGFTdHJpbmcpO1xyXG4gICAgLy8gICBjb25zdCB1c2VyTmFtZSA9IHVzZXJEYXRhLm5hbWUgfHwgXCJVc2VyXCI7XHJcbiAgICAvLyAgIGNvbnN0IHVzZXJOYW1lRGlzcGxheSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwidXNlci1uYW1lLWRpc3BsYXlcIik7XHJcbiAgICAvLyAgIGlmICh1c2VyTmFtZURpc3BsYXkpIHVzZXJOYW1lRGlzcGxheS50ZXh0Q29udGVudCA9IHVzZXJOYW1lO1xyXG4gICAgLy8gfSBjYXRjaCAoZSkge1xyXG4gICAgLy8gICBjb25zb2xlLmVycm9yKFwiSW52YWxpZCB1c2VyIGRhdGEgaW4gbG9jYWxTdG9yYWdlLlwiKTtcclxuICAgIC8vICAgbG9nb3V0KCk7XHJcbiAgICAvLyB9XHJcbiAgfVxyXG5cclxuICByZXR1cm4geyBsb2dvdXQsIGRpc3BsYXlVc2VyRGF0YSB9O1xyXG59KSgpO1xyXG4iLCIvLyBUaGUgbW9kdWxlIGNhY2hlXG52YXIgX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fID0ge307XG5cbi8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG5mdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuXHR2YXIgY2FjaGVkTW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXTtcblx0aWYgKGNhY2hlZE1vZHVsZSAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0cmV0dXJuIGNhY2hlZE1vZHVsZS5leHBvcnRzO1xuXHR9XG5cdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG5cdHZhciBtb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdID0ge1xuXHRcdC8vIG5vIG1vZHVsZS5pZCBuZWVkZWRcblx0XHQvLyBubyBtb2R1bGUubG9hZGVkIG5lZWRlZFxuXHRcdGV4cG9ydHM6IHt9XG5cdH07XG5cblx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG5cdF9fd2VicGFja19tb2R1bGVzX19bbW9kdWxlSWRdKG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG5cdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG5cdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbn1cblxuIiwiLy8gZGVmaW5lIGdldHRlciBmdW5jdGlvbnMgZm9yIGhhcm1vbnkgZXhwb3J0c1xuX193ZWJwYWNrX3JlcXVpcmVfXy5kID0gKGV4cG9ydHMsIGRlZmluaXRpb24pID0+IHtcblx0Zm9yKHZhciBrZXkgaW4gZGVmaW5pdGlvbikge1xuXHRcdGlmKF9fd2VicGFja19yZXF1aXJlX18ubyhkZWZpbml0aW9uLCBrZXkpICYmICFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywga2V5KSkge1xuXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIGtleSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGRlZmluaXRpb25ba2V5XSB9KTtcblx0XHR9XG5cdH1cbn07IiwiX193ZWJwYWNrX3JlcXVpcmVfXy5vID0gKG9iaiwgcHJvcCkgPT4gKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIHByb3ApKSIsIi8vIGRlZmluZSBfX2VzTW9kdWxlIG9uIGV4cG9ydHNcbl9fd2VicGFja19yZXF1aXJlX18uciA9IChleHBvcnRzKSA9PiB7XG5cdGlmKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykge1xuXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pO1xuXHR9XG5cdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG59OyIsImltcG9ydCB7IFVzZXIgfSBmcm9tIFwiLi9tb2R1bGVzL3VzZXIuanNcIjtcclxuaW1wb3J0IHsgRXZlbnRzIH0gZnJvbSBcIi4vbW9kdWxlcy9ldmVudHMuanNcIjtcclxuaW1wb3J0IHsgQXV0aCB9IGZyb20gXCIuL21vZHVsZXMvYXV0aC5qc1wiO1xyXG5cclxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIkRPTUNvbnRlbnRMb2FkZWRcIiwgKCkgPT4ge1xyXG4gIFVzZXIuZGlzcGxheVVzZXJEYXRhKCk7XHJcbiAgY29uc3QgbG9nb3V0QnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJidG4tbG9nb3V0XCIpO1xyXG4gIGlmIChsb2dvdXRCdG4pIGxvZ291dEJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgVXNlci5sb2dvdXQpO1xyXG5cclxuICBjb25zdCBldmVudHNCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImZldGNoRXZlbnRzQnRuXCIpO1xyXG4gIGlmIChldmVudHNCdG4pXHJcbiAgICBldmVudHNCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICBFdmVudHMuZmV0Y2hBbmREaXNwbGF5O1xyXG4gICAgfSk7XHJcblxyXG4gIGNvbnNvbGUubG9nKFwiTWFpbiBhcHAgaW5pdGlhbGl6ZWQuXCIpO1xyXG59KTtcclxuIl0sIm5hbWVzIjpbIkF1dGgiLCJpbml0IiwiZm9ybSIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJjb25zb2xlIiwiZXJyb3IiLCJhZGRFdmVudExpc3RlbmVyIiwiaGFuZGxlU3VibWl0Iiwic3dpdGNoTW9kZSIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJmb3JFYWNoIiwidGFiIiwiZGF0YXNldCIsIm1vZGUiLCJuYW1lRmllbGQiLCJzdWJtaXRCdG4iLCJxdWVyeVNlbGVjdG9yIiwicGFzc3dvcmRJbnB1dCIsInRhYnMiLCJzdHlsZSIsImRpc3BsYXkiLCJyZXF1aXJlZCIsImNsYXNzTGlzdCIsInRvZ2dsZSIsInRleHRDb250ZW50IiwiYXV0b2NvbXBsZXRlIiwiRG9tVXRpbHMiLCJjbGVhck1lc3NhZ2VzIiwiYXN5bmMiLCJlIiwicHJldmVudERlZmF1bHQiLCJMb2FkZXIiLCJpc0xvZ2luIiwiY29udGFpbnMiLCJ1cmwiLCJmb3JtRGF0YSIsImVtYWlsIiwiZ2V0VmFsIiwicGFzc3dvcmQiLCJuYW1lIiwiZGF0YSIsImVycm9ycyIsInRlc3QiLCJwdXNoIiwibGVuZ3RoIiwiRXJyb3IiLCJqb2luIiwidmFsaWRhdGUiLCJyZXNwb25zZSIsImZldGNoIiwibWV0aG9kIiwiaGVhZGVycyIsIkFjY2VwdCIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwiaXNKc29uIiwiZ2V0IiwiaW5jbHVkZXMiLCJqc29uIiwibWVzc2FnZSIsInRleHQiLCJvayIsInN0YXR1cyIsImxvY2FsU3RvcmFnZSIsInNldEl0ZW0iLCJ1c2VyIiwid2luZG93IiwibG9jYXRpb24iLCJocmVmIiwic2hvd1N1Y2Nlc3MiLCJpZCIsImVsIiwidmFsdWUiLCJoYW5kbGVSZXNwb25zZSIsImVyciIsInNob3dFcnJvciIsInRyaW0iLCJyZWFzb24iLCJVUkxTZWFyY2hQYXJhbXMiLCJzZWFyY2giLCJtZXNzYWdlcyIsInVuYXV0aGVudGljYXRlZCIsImludmFsaWRfdG9rZW4iLCJiYWRfdG9rZW5fY2xhaW1zIiwiaGlzdG9yeSIsInJlcGxhY2VTdGF0ZSIsInBhdGhuYW1lIiwiY2hlY2tSZWRpcmVjdFJlYXNvbiIsImNvbnRhaW5lciIsImlubmVySFRNTCIsInBhcmVudE5vZGUiLCJyZW1vdmUiLCJzaG93TWVzc2FnZSIsInR5cGUiLCJtZXNzYWdlRWxlbWVudCIsImNyZWF0ZUVsZW1lbnQiLCJjbGFzc05hbWUiLCJzcGxpdCIsImxpbmUiLCJwIiwiYXBwZW5kQ2hpbGQiLCJpbnNlcnRCZWZvcmUiLCJwcmVwZW5kIiwibXNnIiwiRXZlbnRzIiwiZmV0Y2hBbmREaXNwbGF5Iiwib3V0cHV0RGl2IiwiZXJyb3JEYXRhIiwiY2F0Y2giLCJldmVudHMiLCJzaG93IiwibG9hZGVyIiwiY3JlYXRlIiwiVXNlciIsImxvZ291dCIsImxvZyIsInJlbW92ZUl0ZW0iLCJkaXNwbGF5VXNlckRhdGEiLCJfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18iLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJjYWNoZWRNb2R1bGUiLCJ1bmRlZmluZWQiLCJleHBvcnRzIiwibW9kdWxlIiwiX193ZWJwYWNrX21vZHVsZXNfXyIsImQiLCJkZWZpbml0aW9uIiwia2V5IiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsIm9iaiIsInByb3AiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiLCJyIiwiU3ltYm9sIiwidG9TdHJpbmdUYWciLCJsb2dvdXRCdG4iLCJldmVudHNCdG4iXSwic291cmNlUm9vdCI6IiJ9