/*! For license information please see main.js.LICENSE.txt */
(()=>{"use strict";var e={"./src/modules/auth.js":(e,t,o)=>{o.r(t),o.d(t,{Auth:()=>r});var n=o("./src/modules/loader.js"),s=o("./src/modules/domUtils.js");const r=(()=>{function e(){const e=document.getElementById("authForm");if(!e)return console.error("Auth form not found!");e.addEventListener("submit",o),t("login"),document.querySelectorAll("[data-mode]").forEach((e=>e.addEventListener("click",(()=>{t(e.dataset.mode)}))))}function t(e){const t=document.getElementById("nameField"),o=document.querySelector('#authForm button[type="submit"]'),n=document.getElementById("password"),r=document.querySelectorAll(".tab");t&&(t.style.display="register"===e?"block":"none",document.getElementById("name").required="register"===e),r.forEach((t=>t.classList.toggle("active",t.dataset.mode===e))),o&&(o.textContent="login"===e?"Login":"Register"),n&&(n.autocomplete="login"===e?"current-password":"new-password"),s.DomUtils.clearMessages()}async function o(e){e.preventDefault(),s.DomUtils.clearMessages(),n.Loader.toggle(!0);const o=document.querySelector('[data-mode="login"]').classList.contains("active"),a=o?"/api/login":"/api/register",c={email:r("email"),password:r("password")};o||(c.name=r("name"));try{!function(e,t){const o=[];if(e.email?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.email)||o.push("Invalid email format."):o.push("Email is required."),e.password?e.password.length<8&&!t&&o.push("Password must be at least 8 characters."):o.push("Password is required."),t||e.name&&!(e.name.length<2)||o.push("Name must be at least 2 characters."),o.length)throw new Error(o.join("\n"))}(c,o);const e=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(c)});await async function(e,o){const n=e.headers.get("content-type")?.includes("application/json"),r=n?await e.json():{message:await e.text()};if(!e.ok)throw new Error(r.error||`Error: ${e.status}`);o?(localStorage.setItem("user",JSON.stringify(r.user||{})),window.location.href="/app"):(s.DomUtils.showSuccess(r.message||"Registration successful. Please login."),t("login"),["email","password","name"].forEach((e=>{const t=document.getElementById(e);t&&(t.value="")})))}(e,o)}catch(e){s.DomUtils.showError(e.message||"Unexpected error during submission.")}finally{n.Loader.toggle(!1)}}function r(e){const t=document.getElementById(e);return t?t.value.trim():""}return document.addEventListener("DOMContentLoaded",(()=>{"/login"===window.location.pathname&&(e(),function(){const e=new URLSearchParams(location.search).get("reason"),t={unauthenticated:"Please log in to access the application.",invalid_token:"Session expired. Please log in again.",bad_token_claims:"Session data issue. Please log in again."};e&&t[e]&&s.DomUtils.showError(t[e]),history.replaceState(null,"",location.pathname)}())})),{init:e}})()},"./src/modules/calendar.js":(e,t,o)=>{o.r(t),o.d(t,{Todo:()=>n});const n=(document.addEventListener("DOMContentLoaded",(function(){var e=document.getElementById("calendar");new FullCalendar.Calendar(e,{initialView:"dayGridMonth"}).render()})),{})},"./src/modules/domUtils.js":(e,t,o)=>{o.r(t),o.d(t,{DomUtils:()=>n});const n=(()=>{function e(){const e=document.getElementById("messageContainer");e&&(e.innerHTML=""),document.querySelectorAll(".error-message, .success-message").forEach((t=>{t.parentNode!==e&&t.remove()}))}function t(t,o="error"){e();const n=document.createElement("div");n.className="error"===o?"error-message":"success-message",t.split("\n").forEach((e=>{const t=document.createElement("p");t.textContent=e,n.appendChild(t)}));const s=document.getElementById("messageContainer");if(s)s.appendChild(n);else{const e=document.getElementById("authForm");e?e.parentNode.insertBefore(n,e):document.body.prepend(n)}}return{clearMessages:e,showError:e=>t(e,"error"),showSuccess:e=>t(e,"success")}})()},"./src/modules/events.js":(e,t,o)=>{o.r(t),o.d(t,{Events:()=>s});var n=o("./src/modules/loader.js");const s={fetchAndDisplay:async function(){const e=document.getElementById("eventsOutput");if(e){e.innerHTML="Loading events...",n.Loader.toggle(!0);try{const t=await fetch("/api/events",{method:"GET",headers:{Accept:"application/json"}});if(!t.ok){const e=await t.json().catch((()=>({})));throw new Error(e.error||`HTTP error! Status: ${t.status}`)}const o=await t.json();e.innerHTML=o.length?"<h4>Received Events:</h4><pre>"+JSON.stringify(o,null,2)+"</pre>":"No events found for your account."}catch(t){console.error("Error fetching events:",t),e.innerHTML=`<p class="api-error-message">Error loading events: ${t.message}</p>`}finally{n.Loader.toggle(!1)}}}}},"./src/modules/loader.js":(e,t,o)=>{o.r(t),o.d(t,{Loader:()=>n});const n={toggle:function(e){let t=document.getElementById("loader");!t&&e&&(t=function(){const e=document.createElement("div");return e.id="loader",e.className="loader",e.innerHTML='<div class="spinner"></div>',document.body.appendChild(e),e}()),t&&(t.style.display=e?"flex":"none")}}},"./src/modules/user.js":(e,t,o)=>{o.r(t),o.d(t,{User:()=>r});var n=o("./src/modules/loader.js"),s=o("./src/modules/domUtils.js");const r=(()=>{async function e(){console.log("Attempting logout..."),n.Loader.toggle(!0);try{const e=await fetch("/api/logout",{method:"POST",headers:{Accept:"application/json"}}),t=await e.json().catch((()=>({})));if(!e.ok)throw new Error(t.error||`Logout failed with status: ${e.status}`);console.log("Logout successful via API.")}catch(e){console.error("Logout API call failed:",e),s.DomUtils.showError("Could not properly log out. Clear cookies manually if needed.")}finally{localStorage.removeItem("user"),n.Loader.toggle(!1),window.location.href="/login"}}return{logout:e,displayUserData:function(){const t=localStorage.getItem("user");if(!t)return e();try{const e=JSON.parse(t).name||"User",o=document.getElementById("user-name-display");o&&(o.textContent=e)}catch(t){console.error("Invalid user data in localStorage."),e()}}}})()}},t={};function o(n){var s=t[n];if(void 0!==s)return s.exports;var r=t[n]={exports:{}};return e[n](r,r.exports,o),r.exports}o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n={};(()=>{o.r(n);var e=o("./src/modules/user.js"),t=o("./src/modules/events.js");o("./src/modules/auth.js"),o("./src/modules/calendar.js"),document.addEventListener("DOMContentLoaded",(()=>{"/app"===window.location.pathname&&e.User.displayUserData();const o=document.getElementById("btn-logout");o&&o.addEventListener("click",e.User.logout);const n=document.getElementById("fetchEventsBtn");n&&n.addEventListener("click",(()=>t.Events.fetchAndDisplay)),console.log("Main app initialized.")}))})()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUksd0JBQXdCIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc3RhdGljLy4vc3JjL21vZHVsZXMvYXV0aC5qcyIsIndlYnBhY2s6Ly9zdGF0aWMvLi9zcmMvbW9kdWxlcy9jYWxlbmRhci5qcyIsIndlYnBhY2s6Ly9zdGF0aWMvLi9zcmMvbW9kdWxlcy9kb21VdGlscy5qcyIsIndlYnBhY2s6Ly9zdGF0aWMvLi9zcmMvbW9kdWxlcy9ldmVudHMuanMiLCJ3ZWJwYWNrOi8vc3RhdGljLy4vc3JjL21vZHVsZXMvbG9hZGVyLmpzIiwid2VicGFjazovL3N0YXRpYy8uL3NyYy9tb2R1bGVzL3VzZXIuanMiLCJ3ZWJwYWNrOi8vc3RhdGljL3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovL3N0YXRpYy93ZWJwYWNrL3J1bnRpbWUvZGVmaW5lIHByb3BlcnR5IGdldHRlcnMiLCJ3ZWJwYWNrOi8vc3RhdGljL3dlYnBhY2svcnVudGltZS9oYXNPd25Qcm9wZXJ0eSBzaG9ydGhhbmQiLCJ3ZWJwYWNrOi8vc3RhdGljL3dlYnBhY2svcnVudGltZS9tYWtlIG5hbWVzcGFjZSBvYmplY3QiLCJ3ZWJwYWNrOi8vc3RhdGljLy4vc3JjL2luZGV4LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IExvYWRlciB9IGZyb20gXCIuL2xvYWRlci5qc1wiO1xyXG5pbXBvcnQgeyBEb21VdGlscyB9IGZyb20gXCIuL2RvbVV0aWxzLmpzXCI7XHJcblxyXG5leHBvcnQgY29uc3QgQXV0aCA9ICgoKSA9PiB7XHJcbiAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIkRPTUNvbnRlbnRMb2FkZWRcIiwgKCkgPT4ge1xyXG4gICAgaWYgKHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZSA9PT0gXCIvbG9naW5cIikge1xyXG4gICAgICBpbml0KCk7XHJcbiAgICAgIGNoZWNrUmVkaXJlY3RSZWFzb24oKTtcclxuICAgIH1cclxuICB9KTtcclxuXHJcbiAgZnVuY3Rpb24gaW5pdCgpIHtcclxuICAgIGNvbnN0IGZvcm0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImF1dGhGb3JtXCIpO1xyXG4gICAgaWYgKCFmb3JtKSByZXR1cm4gY29uc29sZS5lcnJvcihcIkF1dGggZm9ybSBub3QgZm91bmQhXCIpO1xyXG5cclxuICAgIGZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBoYW5kbGVTdWJtaXQpO1xyXG4gICAgc3dpdGNoTW9kZShcImxvZ2luXCIpO1xyXG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIltkYXRhLW1vZGVdXCIpLmZvckVhY2goKHRhYikgPT5cclxuICAgICAgdGFiLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgICAgICAgc3dpdGNoTW9kZSh0YWIuZGF0YXNldC5tb2RlKTtcclxuICAgICAgfSlcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBzd2l0Y2hNb2RlKG1vZGUpIHtcclxuICAgIGNvbnN0IG5hbWVGaWVsZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwibmFtZUZpZWxkXCIpO1xyXG4gICAgY29uc3Qgc3VibWl0QnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2F1dGhGb3JtIGJ1dHRvblt0eXBlPVwic3VibWl0XCJdJyk7XHJcbiAgICBjb25zdCBwYXNzd29yZElucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJwYXNzd29yZFwiKTtcclxuICAgIGNvbnN0IHRhYnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLnRhYlwiKTtcclxuXHJcbiAgICBpZiAobmFtZUZpZWxkKSB7XHJcbiAgICAgIG5hbWVGaWVsZC5zdHlsZS5kaXNwbGF5ID0gbW9kZSA9PT0gXCJyZWdpc3RlclwiID8gXCJibG9ja1wiIDogXCJub25lXCI7XHJcbiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwibmFtZVwiKS5yZXF1aXJlZCA9IG1vZGUgPT09IFwicmVnaXN0ZXJcIjtcclxuICAgIH1cclxuICAgIHRhYnMuZm9yRWFjaCgodGFiKSA9PlxyXG4gICAgICB0YWIuY2xhc3NMaXN0LnRvZ2dsZShcImFjdGl2ZVwiLCB0YWIuZGF0YXNldC5tb2RlID09PSBtb2RlKVxyXG4gICAgKTtcclxuICAgIGlmIChzdWJtaXRCdG4pXHJcbiAgICAgIHN1Ym1pdEJ0bi50ZXh0Q29udGVudCA9IG1vZGUgPT09IFwibG9naW5cIiA/IFwiTG9naW5cIiA6IFwiUmVnaXN0ZXJcIjtcclxuICAgIGlmIChwYXNzd29yZElucHV0KVxyXG4gICAgICBwYXNzd29yZElucHV0LmF1dG9jb21wbGV0ZSA9XHJcbiAgICAgICAgbW9kZSA9PT0gXCJsb2dpblwiID8gXCJjdXJyZW50LXBhc3N3b3JkXCIgOiBcIm5ldy1wYXNzd29yZFwiO1xyXG5cclxuICAgIERvbVV0aWxzLmNsZWFyTWVzc2FnZXMoKTtcclxuICB9XHJcblxyXG4gIGFzeW5jIGZ1bmN0aW9uIGhhbmRsZVN1Ym1pdChlKSB7XHJcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICBEb21VdGlscy5jbGVhck1lc3NhZ2VzKCk7XHJcbiAgICBMb2FkZXIudG9nZ2xlKHRydWUpO1xyXG5cclxuICAgIGNvbnN0IGlzTG9naW4gPSBkb2N1bWVudFxyXG4gICAgICAucXVlcnlTZWxlY3RvcignW2RhdGEtbW9kZT1cImxvZ2luXCJdJylcclxuICAgICAgLmNsYXNzTGlzdC5jb250YWlucyhcImFjdGl2ZVwiKTtcclxuICAgIGNvbnN0IHVybCA9IGlzTG9naW4gPyBcIi9hcGkvbG9naW5cIiA6IFwiL2FwaS9yZWdpc3RlclwiO1xyXG4gICAgY29uc3QgZm9ybURhdGEgPSB7XHJcbiAgICAgIGVtYWlsOiBnZXRWYWwoXCJlbWFpbFwiKSxcclxuICAgICAgcGFzc3dvcmQ6IGdldFZhbChcInBhc3N3b3JkXCIpLFxyXG4gICAgfTtcclxuXHJcbiAgICBpZiAoIWlzTG9naW4pIGZvcm1EYXRhLm5hbWUgPSBnZXRWYWwoXCJuYW1lXCIpO1xyXG5cclxuICAgIHRyeSB7XHJcbiAgICAgIHZhbGlkYXRlKGZvcm1EYXRhLCBpc0xvZ2luKTtcclxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCh1cmwsIHtcclxuICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxyXG4gICAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxyXG4gICAgICAgICAgQWNjZXB0OiBcImFwcGxpY2F0aW9uL2pzb25cIixcclxuICAgICAgICB9LFxyXG4gICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KGZvcm1EYXRhKSxcclxuICAgICAgfSk7XHJcbiAgICAgIGF3YWl0IGhhbmRsZVJlc3BvbnNlKHJlc3BvbnNlLCBpc0xvZ2luKTtcclxuICAgIH0gY2F0Y2ggKGVycikge1xyXG4gICAgICBEb21VdGlscy5zaG93RXJyb3IoZXJyLm1lc3NhZ2UgfHwgXCJVbmV4cGVjdGVkIGVycm9yIGR1cmluZyBzdWJtaXNzaW9uLlwiKTtcclxuICAgIH0gZmluYWxseSB7XHJcbiAgICAgIExvYWRlci50b2dnbGUoZmFsc2UpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gZ2V0VmFsKGlkKSB7XHJcbiAgICBjb25zdCBlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKTtcclxuICAgIHJldHVybiBlbCA/IGVsLnZhbHVlLnRyaW0oKSA6IFwiXCI7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiB2YWxpZGF0ZShkYXRhLCBpc0xvZ2luKSB7XHJcbiAgICBjb25zdCBlcnJvcnMgPSBbXTtcclxuICAgIGNvbnN0IGVtYWlsUmVnZXggPSAvXlteXFxzQF0rQFteXFxzQF0rXFwuW15cXHNAXSskLztcclxuXHJcbiAgICBpZiAoIWRhdGEuZW1haWwpIGVycm9ycy5wdXNoKFwiRW1haWwgaXMgcmVxdWlyZWQuXCIpO1xyXG4gICAgZWxzZSBpZiAoIWVtYWlsUmVnZXgudGVzdChkYXRhLmVtYWlsKSkgZXJyb3JzLnB1c2goXCJJbnZhbGlkIGVtYWlsIGZvcm1hdC5cIik7XHJcbiAgICBpZiAoIWRhdGEucGFzc3dvcmQpIGVycm9ycy5wdXNoKFwiUGFzc3dvcmQgaXMgcmVxdWlyZWQuXCIpO1xyXG4gICAgZWxzZSBpZiAoZGF0YS5wYXNzd29yZC5sZW5ndGggPCA4ICYmICFpc0xvZ2luKVxyXG4gICAgICBlcnJvcnMucHVzaChcIlBhc3N3b3JkIG11c3QgYmUgYXQgbGVhc3QgOCBjaGFyYWN0ZXJzLlwiKTtcclxuICAgIGlmICghaXNMb2dpbiAmJiAoIWRhdGEubmFtZSB8fCBkYXRhLm5hbWUubGVuZ3RoIDwgMikpXHJcbiAgICAgIGVycm9ycy5wdXNoKFwiTmFtZSBtdXN0IGJlIGF0IGxlYXN0IDIgY2hhcmFjdGVycy5cIik7XHJcblxyXG4gICAgaWYgKGVycm9ycy5sZW5ndGgpIHRocm93IG5ldyBFcnJvcihlcnJvcnMuam9pbihcIlxcblwiKSk7XHJcbiAgfVxyXG5cclxuICBhc3luYyBmdW5jdGlvbiBoYW5kbGVSZXNwb25zZShyZXNwb25zZSwgaXNMb2dpbikge1xyXG4gICAgY29uc3QgaXNKc29uID0gcmVzcG9uc2UuaGVhZGVyc1xyXG4gICAgICAuZ2V0KFwiY29udGVudC10eXBlXCIpXHJcbiAgICAgID8uaW5jbHVkZXMoXCJhcHBsaWNhdGlvbi9qc29uXCIpO1xyXG4gICAgY29uc3QgZGF0YSA9IGlzSnNvblxyXG4gICAgICA/IGF3YWl0IHJlc3BvbnNlLmpzb24oKVxyXG4gICAgICA6IHsgbWVzc2FnZTogYXdhaXQgcmVzcG9uc2UudGV4dCgpIH07XHJcblxyXG4gICAgaWYgKCFyZXNwb25zZS5vaylcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKGRhdGEuZXJyb3IgfHwgYEVycm9yOiAke3Jlc3BvbnNlLnN0YXR1c31gKTtcclxuXHJcbiAgICBpZiAoaXNMb2dpbikge1xyXG4gICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShcInVzZXJcIiwgSlNPTi5zdHJpbmdpZnkoZGF0YS51c2VyIHx8IHt9KSk7XHJcbiAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gXCIvYXBwXCI7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBEb21VdGlscy5zaG93U3VjY2VzcyhcclxuICAgICAgICBkYXRhLm1lc3NhZ2UgfHwgXCJSZWdpc3RyYXRpb24gc3VjY2Vzc2Z1bC4gUGxlYXNlIGxvZ2luLlwiXHJcbiAgICAgICk7XHJcbiAgICAgIHN3aXRjaE1vZGUoXCJsb2dpblwiKTtcclxuICAgICAgW1wiZW1haWxcIiwgXCJwYXNzd29yZFwiLCBcIm5hbWVcIl0uZm9yRWFjaCgoaWQpID0+IHtcclxuICAgICAgICBjb25zdCBlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKTtcclxuICAgICAgICBpZiAoZWwpIGVsLnZhbHVlID0gXCJcIjtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBjaGVja1JlZGlyZWN0UmVhc29uKCkge1xyXG4gICAgY29uc3QgcmVhc29uID0gbmV3IFVSTFNlYXJjaFBhcmFtcyhsb2NhdGlvbi5zZWFyY2gpLmdldChcInJlYXNvblwiKTtcclxuICAgIGNvbnN0IG1lc3NhZ2VzID0ge1xyXG4gICAgICB1bmF1dGhlbnRpY2F0ZWQ6IFwiUGxlYXNlIGxvZyBpbiB0byBhY2Nlc3MgdGhlIGFwcGxpY2F0aW9uLlwiLFxyXG4gICAgICBpbnZhbGlkX3Rva2VuOiBcIlNlc3Npb24gZXhwaXJlZC4gUGxlYXNlIGxvZyBpbiBhZ2Fpbi5cIixcclxuICAgICAgYmFkX3Rva2VuX2NsYWltczogXCJTZXNzaW9uIGRhdGEgaXNzdWUuIFBsZWFzZSBsb2cgaW4gYWdhaW4uXCIsXHJcbiAgICB9O1xyXG4gICAgaWYgKHJlYXNvbiAmJiBtZXNzYWdlc1tyZWFzb25dKSBEb21VdGlscy5zaG93RXJyb3IobWVzc2FnZXNbcmVhc29uXSk7XHJcbiAgICBoaXN0b3J5LnJlcGxhY2VTdGF0ZShudWxsLCBcIlwiLCBsb2NhdGlvbi5wYXRobmFtZSk7XHJcbiAgfVxyXG5cclxuICByZXR1cm4geyBpbml0IH07XHJcbn0pKCk7XHJcbiIsImV4cG9ydCBjb25zdCBUb2RvID0gKCgpID0+IHtcclxuICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwiRE9NQ29udGVudExvYWRlZFwiLCBmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgY2FsZW5kYXJFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiY2FsZW5kYXJcIik7XHJcbiAgICB2YXIgY2FsZW5kYXIgPSBuZXcgRnVsbENhbGVuZGFyLkNhbGVuZGFyKGNhbGVuZGFyRWwsIHtcclxuICAgICAgaW5pdGlhbFZpZXc6IFwiZGF5R3JpZE1vbnRoXCIsXHJcbiAgICB9KTtcclxuICAgIGNhbGVuZGFyLnJlbmRlcigpO1xyXG4gIH0pO1xyXG4gIHJldHVybiB7fTtcclxufSkoKTtcclxuIiwiZXhwb3J0IGNvbnN0IERvbVV0aWxzID0gKCgpID0+IHtcclxuICBmdW5jdGlvbiBjbGVhck1lc3NhZ2VzKCkge1xyXG4gICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJtZXNzYWdlQ29udGFpbmVyXCIpO1xyXG4gICAgaWYgKGNvbnRhaW5lcikgY29udGFpbmVyLmlubmVySFRNTCA9IFwiXCI7XHJcbiAgICBkb2N1bWVudFxyXG4gICAgICAucXVlcnlTZWxlY3RvckFsbChcIi5lcnJvci1tZXNzYWdlLCAuc3VjY2Vzcy1tZXNzYWdlXCIpXHJcbiAgICAgIC5mb3JFYWNoKChlbCkgPT4ge1xyXG4gICAgICAgIGlmIChlbC5wYXJlbnROb2RlICE9PSBjb250YWluZXIpIGVsLnJlbW92ZSgpO1xyXG4gICAgICB9KTtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIHNob3dNZXNzYWdlKG1lc3NhZ2UsIHR5cGUgPSBcImVycm9yXCIpIHtcclxuICAgIGNsZWFyTWVzc2FnZXMoKTtcclxuICAgIGNvbnN0IG1lc3NhZ2VFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgIG1lc3NhZ2VFbGVtZW50LmNsYXNzTmFtZSA9XHJcbiAgICAgIHR5cGUgPT09IFwiZXJyb3JcIiA/IFwiZXJyb3ItbWVzc2FnZVwiIDogXCJzdWNjZXNzLW1lc3NhZ2VcIjtcclxuICAgIG1lc3NhZ2Uuc3BsaXQoXCJcXG5cIikuZm9yRWFjaCgobGluZSkgPT4ge1xyXG4gICAgICBjb25zdCBwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInBcIik7XHJcbiAgICAgIHAudGV4dENvbnRlbnQgPSBsaW5lO1xyXG4gICAgICBtZXNzYWdlRWxlbWVudC5hcHBlbmRDaGlsZChwKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwibWVzc2FnZUNvbnRhaW5lclwiKTtcclxuICAgIGlmIChjb250YWluZXIpIHtcclxuICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKG1lc3NhZ2VFbGVtZW50KTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGNvbnN0IGZvcm0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImF1dGhGb3JtXCIpO1xyXG4gICAgICBmb3JtXHJcbiAgICAgICAgPyBmb3JtLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKG1lc3NhZ2VFbGVtZW50LCBmb3JtKVxyXG4gICAgICAgIDogZG9jdW1lbnQuYm9keS5wcmVwZW5kKG1lc3NhZ2VFbGVtZW50KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHJldHVybiB7XHJcbiAgICBjbGVhck1lc3NhZ2VzLFxyXG4gICAgc2hvd0Vycm9yOiAobXNnKSA9PiBzaG93TWVzc2FnZShtc2csIFwiZXJyb3JcIiksXHJcbiAgICBzaG93U3VjY2VzczogKG1zZykgPT4gc2hvd01lc3NhZ2UobXNnLCBcInN1Y2Nlc3NcIiksXHJcbiAgfTtcclxufSkoKTtcclxuIiwiaW1wb3J0IHsgTG9hZGVyIH0gZnJvbSBcIi4vbG9hZGVyLmpzXCI7XHJcblxyXG5leHBvcnQgY29uc3QgRXZlbnRzID0gKCgpID0+IHtcclxuICBhc3luYyBmdW5jdGlvbiBmZXRjaEFuZERpc3BsYXkoKSB7XHJcbiAgICBjb25zdCBvdXRwdXREaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImV2ZW50c091dHB1dFwiKTtcclxuICAgIGlmICghb3V0cHV0RGl2KSByZXR1cm47XHJcblxyXG4gICAgb3V0cHV0RGl2LmlubmVySFRNTCA9IFwiTG9hZGluZyBldmVudHMuLi5cIjtcclxuICAgIExvYWRlci50b2dnbGUodHJ1ZSk7XHJcblxyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChcIi9hcGkvZXZlbnRzXCIsIHtcclxuICAgICAgICBtZXRob2Q6IFwiR0VUXCIsXHJcbiAgICAgICAgaGVhZGVyczogeyBBY2NlcHQ6IFwiYXBwbGljYXRpb24vanNvblwiIH0sXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgaWYgKCFyZXNwb25zZS5vaykge1xyXG4gICAgICAgIGNvbnN0IGVycm9yRGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKS5jYXRjaCgoKSA9PiAoe30pKTtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXHJcbiAgICAgICAgICBlcnJvckRhdGEuZXJyb3IgfHwgYEhUVFAgZXJyb3IhIFN0YXR1czogJHtyZXNwb25zZS5zdGF0dXN9YFxyXG4gICAgICAgICk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IGV2ZW50cyA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcclxuICAgICAgb3V0cHV0RGl2LmlubmVySFRNTCA9IGV2ZW50cy5sZW5ndGhcclxuICAgICAgICA/IFwiPGg0PlJlY2VpdmVkIEV2ZW50czo8L2g0PjxwcmU+XCIgK1xyXG4gICAgICAgICAgSlNPTi5zdHJpbmdpZnkoZXZlbnRzLCBudWxsLCAyKSArXHJcbiAgICAgICAgICBcIjwvcHJlPlwiXHJcbiAgICAgICAgOiBcIk5vIGV2ZW50cyBmb3VuZCBmb3IgeW91ciBhY2NvdW50LlwiO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGV2ZW50czpcIiwgZXJyb3IpO1xyXG4gICAgICBvdXRwdXREaXYuaW5uZXJIVE1MID0gYDxwIGNsYXNzPVwiYXBpLWVycm9yLW1lc3NhZ2VcIj5FcnJvciBsb2FkaW5nIGV2ZW50czogJHtlcnJvci5tZXNzYWdlfTwvcD5gO1xyXG4gICAgfSBmaW5hbGx5IHtcclxuICAgICAgTG9hZGVyLnRvZ2dsZShmYWxzZSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICByZXR1cm4geyBmZXRjaEFuZERpc3BsYXkgfTtcclxufSkoKTtcclxuIiwiZXhwb3J0IGNvbnN0IExvYWRlciA9ICgoKSA9PiB7XHJcbiAgZnVuY3Rpb24gdG9nZ2xlKHNob3cpIHtcclxuICAgIGxldCBsb2FkZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImxvYWRlclwiKTtcclxuICAgIGlmICghbG9hZGVyICYmIHNob3cpIGxvYWRlciA9IGNyZWF0ZSgpO1xyXG4gICAgaWYgKGxvYWRlcikgbG9hZGVyLnN0eWxlLmRpc3BsYXkgPSBzaG93ID8gXCJmbGV4XCIgOiBcIm5vbmVcIjtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIGNyZWF0ZSgpIHtcclxuICAgIGNvbnN0IGxvYWRlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICBsb2FkZXIuaWQgPSBcImxvYWRlclwiO1xyXG4gICAgbG9hZGVyLmNsYXNzTmFtZSA9IFwibG9hZGVyXCI7XHJcbiAgICBsb2FkZXIuaW5uZXJIVE1MID0gJzxkaXYgY2xhc3M9XCJzcGlubmVyXCI+PC9kaXY+JztcclxuICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQobG9hZGVyKTtcclxuICAgIHJldHVybiBsb2FkZXI7XHJcbiAgfVxyXG5cclxuICByZXR1cm4geyB0b2dnbGUgfTtcclxufSkoKTtcclxuIiwiaW1wb3J0IHsgTG9hZGVyIH0gZnJvbSBcIi4vbG9hZGVyLmpzXCI7XHJcbmltcG9ydCB7IERvbVV0aWxzIH0gZnJvbSBcIi4vZG9tVXRpbHMuanNcIjtcclxuXHJcbmV4cG9ydCBjb25zdCBVc2VyID0gKCgpID0+IHtcclxuICBhc3luYyBmdW5jdGlvbiBsb2dvdXQoKSB7XHJcbiAgICBjb25zb2xlLmxvZyhcIkF0dGVtcHRpbmcgbG9nb3V0Li4uXCIpO1xyXG4gICAgTG9hZGVyLnRvZ2dsZSh0cnVlKTtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goXCIvYXBpL2xvZ291dFwiLCB7XHJcbiAgICAgICAgbWV0aG9kOiBcIlBPU1RcIixcclxuICAgICAgICBoZWFkZXJzOiB7IEFjY2VwdDogXCJhcHBsaWNhdGlvbi9qc29uXCIgfSxcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpLmNhdGNoKCgpID0+ICh7fSkpO1xyXG4gICAgICBpZiAoIXJlc3BvbnNlLm9rKVxyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcclxuICAgICAgICAgIGRhdGEuZXJyb3IgfHwgYExvZ291dCBmYWlsZWQgd2l0aCBzdGF0dXM6ICR7cmVzcG9uc2Uuc3RhdHVzfWBcclxuICAgICAgICApO1xyXG4gICAgICBjb25zb2xlLmxvZyhcIkxvZ291dCBzdWNjZXNzZnVsIHZpYSBBUEkuXCIpO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcihcIkxvZ291dCBBUEkgY2FsbCBmYWlsZWQ6XCIsIGVycm9yKTtcclxuICAgICAgRG9tVXRpbHMuc2hvd0Vycm9yKFxyXG4gICAgICAgIFwiQ291bGQgbm90IHByb3Blcmx5IGxvZyBvdXQuIENsZWFyIGNvb2tpZXMgbWFudWFsbHkgaWYgbmVlZGVkLlwiXHJcbiAgICAgICk7XHJcbiAgICB9IGZpbmFsbHkge1xyXG4gICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShcInVzZXJcIik7XHJcbiAgICAgIExvYWRlci50b2dnbGUoZmFsc2UpO1xyXG4gICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IFwiL2xvZ2luXCI7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBkaXNwbGF5VXNlckRhdGEoKSB7XHJcbiAgICBjb25zdCB1c2VyRGF0YVN0cmluZyA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKFwidXNlclwiKTtcclxuICAgIGlmICghdXNlckRhdGFTdHJpbmcpIHJldHVybiBsb2dvdXQoKTtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHVzZXJEYXRhID0gSlNPTi5wYXJzZSh1c2VyRGF0YVN0cmluZyk7XHJcbiAgICAgIGNvbnN0IHVzZXJOYW1lID0gdXNlckRhdGEubmFtZSB8fCBcIlVzZXJcIjtcclxuICAgICAgY29uc3QgdXNlck5hbWVEaXNwbGF5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ1c2VyLW5hbWUtZGlzcGxheVwiKTtcclxuICAgICAgaWYgKHVzZXJOYW1lRGlzcGxheSkgdXNlck5hbWVEaXNwbGF5LnRleHRDb250ZW50ID0gdXNlck5hbWU7XHJcbiAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJJbnZhbGlkIHVzZXIgZGF0YSBpbiBsb2NhbFN0b3JhZ2UuXCIpO1xyXG4gICAgICBsb2dvdXQoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHJldHVybiB7IGxvZ291dCwgZGlzcGxheVVzZXJEYXRhIH07XHJcbn0pKCk7XHJcbiIsIi8vIFRoZSBtb2R1bGUgY2FjaGVcbnZhciBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18gPSB7fTtcblxuLy8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbmZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG5cdHZhciBjYWNoZWRNb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdO1xuXHRpZiAoY2FjaGVkTW9kdWxlICE9PSB1bmRlZmluZWQpIHtcblx0XHRyZXR1cm4gY2FjaGVkTW9kdWxlLmV4cG9ydHM7XG5cdH1cblx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcblx0dmFyIG1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF0gPSB7XG5cdFx0Ly8gbm8gbW9kdWxlLmlkIG5lZWRlZFxuXHRcdC8vIG5vIG1vZHVsZS5sb2FkZWQgbmVlZGVkXG5cdFx0ZXhwb3J0czoge31cblx0fTtcblxuXHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cblx0X193ZWJwYWNrX21vZHVsZXNfX1ttb2R1bGVJZF0obW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cblx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcblx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xufVxuXG4iLCIvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9ucyBmb3IgaGFybW9ueSBleHBvcnRzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSAoZXhwb3J0cywgZGVmaW5pdGlvbikgPT4ge1xuXHRmb3IodmFyIGtleSBpbiBkZWZpbml0aW9uKSB7XG5cdFx0aWYoX193ZWJwYWNrX3JlcXVpcmVfXy5vKGRlZmluaXRpb24sIGtleSkgJiYgIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBrZXkpKSB7XG5cdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywga2V5LCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZGVmaW5pdGlvbltrZXldIH0pO1xuXHRcdH1cblx0fVxufTsiLCJfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSAob2JqLCBwcm9wKSA9PiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwgcHJvcCkpIiwiLy8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuX193ZWJwYWNrX3JlcXVpcmVfXy5yID0gKGV4cG9ydHMpID0+IHtcblx0aWYodHlwZW9mIFN5bWJvbCAhPT0gJ3VuZGVmaW5lZCcgJiYgU3ltYm9sLnRvU3RyaW5nVGFnKSB7XG5cdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSk7XG5cdH1cblx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTtcbn07IiwiaW1wb3J0IHsgVXNlciB9IGZyb20gXCIuL21vZHVsZXMvdXNlci5qc1wiO1xyXG5pbXBvcnQgeyBFdmVudHMgfSBmcm9tIFwiLi9tb2R1bGVzL2V2ZW50cy5qc1wiO1xyXG5pbXBvcnQgeyBBdXRoIH0gZnJvbSBcIi4vbW9kdWxlcy9hdXRoLmpzXCI7XHJcbmltcG9ydCB7IFRvZG8gfSBmcm9tIFwiLi9tb2R1bGVzL2NhbGVuZGFyLmpzXCI7XHJcblxyXG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwiRE9NQ29udGVudExvYWRlZFwiLCAoKSA9PiB7XHJcbiAgaWYgKHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZSA9PT0gXCIvYXBwXCIpIHtcclxuICAgIFVzZXIuZGlzcGxheVVzZXJEYXRhKCk7XHJcbiAgfVxyXG4gIGNvbnN0IGxvZ291dEJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiYnRuLWxvZ291dFwiKTtcclxuICBpZiAobG9nb3V0QnRuKSBsb2dvdXRCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIFVzZXIubG9nb3V0KTtcclxuXHJcbiAgY29uc3QgZXZlbnRzQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJmZXRjaEV2ZW50c0J0blwiKTtcclxuICBpZiAoZXZlbnRzQnRuKVxyXG4gICAgZXZlbnRzQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiBFdmVudHMuZmV0Y2hBbmREaXNwbGF5KTtcclxuXHJcbiAgY29uc29sZS5sb2coXCJNYWluIGFwcCBpbml0aWFsaXplZC5cIik7XHJcbn0pO1xyXG4iXSwibmFtZXMiOlsiQXV0aCIsImluaXQiLCJmb3JtIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsImNvbnNvbGUiLCJlcnJvciIsImFkZEV2ZW50TGlzdGVuZXIiLCJoYW5kbGVTdWJtaXQiLCJzd2l0Y2hNb2RlIiwicXVlcnlTZWxlY3RvckFsbCIsImZvckVhY2giLCJ0YWIiLCJkYXRhc2V0IiwibW9kZSIsIm5hbWVGaWVsZCIsInN1Ym1pdEJ0biIsInF1ZXJ5U2VsZWN0b3IiLCJwYXNzd29yZElucHV0IiwidGFicyIsInN0eWxlIiwiZGlzcGxheSIsInJlcXVpcmVkIiwiY2xhc3NMaXN0IiwidG9nZ2xlIiwidGV4dENvbnRlbnQiLCJhdXRvY29tcGxldGUiLCJEb21VdGlscyIsImNsZWFyTWVzc2FnZXMiLCJhc3luYyIsImUiLCJwcmV2ZW50RGVmYXVsdCIsIkxvYWRlciIsImlzTG9naW4iLCJjb250YWlucyIsInVybCIsImZvcm1EYXRhIiwiZW1haWwiLCJnZXRWYWwiLCJwYXNzd29yZCIsIm5hbWUiLCJkYXRhIiwiZXJyb3JzIiwidGVzdCIsInB1c2giLCJsZW5ndGgiLCJFcnJvciIsImpvaW4iLCJ2YWxpZGF0ZSIsInJlc3BvbnNlIiwiZmV0Y2giLCJtZXRob2QiLCJoZWFkZXJzIiwiQWNjZXB0IiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJpc0pzb24iLCJnZXQiLCJpbmNsdWRlcyIsImpzb24iLCJtZXNzYWdlIiwidGV4dCIsIm9rIiwic3RhdHVzIiwibG9jYWxTdG9yYWdlIiwic2V0SXRlbSIsInVzZXIiLCJ3aW5kb3ciLCJsb2NhdGlvbiIsImhyZWYiLCJzaG93U3VjY2VzcyIsImlkIiwiZWwiLCJ2YWx1ZSIsImhhbmRsZVJlc3BvbnNlIiwiZXJyIiwic2hvd0Vycm9yIiwidHJpbSIsInBhdGhuYW1lIiwicmVhc29uIiwiVVJMU2VhcmNoUGFyYW1zIiwic2VhcmNoIiwibWVzc2FnZXMiLCJ1bmF1dGhlbnRpY2F0ZWQiLCJpbnZhbGlkX3Rva2VuIiwiYmFkX3Rva2VuX2NsYWltcyIsImhpc3RvcnkiLCJyZXBsYWNlU3RhdGUiLCJjaGVja1JlZGlyZWN0UmVhc29uIiwiVG9kbyIsImNhbGVuZGFyRWwiLCJGdWxsQ2FsZW5kYXIiLCJDYWxlbmRhciIsImluaXRpYWxWaWV3IiwicmVuZGVyIiwiY29udGFpbmVyIiwiaW5uZXJIVE1MIiwicGFyZW50Tm9kZSIsInJlbW92ZSIsInNob3dNZXNzYWdlIiwidHlwZSIsIm1lc3NhZ2VFbGVtZW50IiwiY3JlYXRlRWxlbWVudCIsImNsYXNzTmFtZSIsInNwbGl0IiwibGluZSIsInAiLCJhcHBlbmRDaGlsZCIsImluc2VydEJlZm9yZSIsInByZXBlbmQiLCJtc2ciLCJFdmVudHMiLCJmZXRjaEFuZERpc3BsYXkiLCJvdXRwdXREaXYiLCJlcnJvckRhdGEiLCJjYXRjaCIsImV2ZW50cyIsInNob3ciLCJsb2FkZXIiLCJjcmVhdGUiLCJVc2VyIiwibG9nb3V0IiwibG9nIiwicmVtb3ZlSXRlbSIsImRpc3BsYXlVc2VyRGF0YSIsInVzZXJEYXRhU3RyaW5nIiwiZ2V0SXRlbSIsInVzZXJOYW1lIiwicGFyc2UiLCJ1c2VyTmFtZURpc3BsYXkiLCJfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18iLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJjYWNoZWRNb2R1bGUiLCJ1bmRlZmluZWQiLCJleHBvcnRzIiwibW9kdWxlIiwiX193ZWJwYWNrX21vZHVsZXNfXyIsImQiLCJkZWZpbml0aW9uIiwia2V5IiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsIm9iaiIsInByb3AiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiLCJyIiwiU3ltYm9sIiwidG9TdHJpbmdUYWciLCJsb2dvdXRCdG4iLCJldmVudHNCdG4iXSwic291cmNlUm9vdCI6IiJ9